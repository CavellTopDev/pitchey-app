# Database Consistency Issue Template

Use this template when database consistency tests fail.

---

## Issue Title
`[DB Consistency] Brief description of the issue`

## Test Failure
**Test Suite**: (consistency / integrity / quality)
**Test Name**: Full test name from output
**Date**: YYYY-MM-DD

## Error Message
```
Paste error message here
```

## Test Output
```
Paste relevant test output here
```

## Database State

### Affected Tables
- table_name_1
- table_name_2

### Query to Reproduce
```sql
-- SQL query that demonstrates the issue
SELECT ...
```

### Record Count
```
Found X orphaned/invalid records
```

## Impact Assessment

**Severity**: (Critical / High / Medium / Low)
- [ ] Critical - Data loss possible
- [ ] High - Data integrity compromised
- [ ] Medium - Inconsistency exists but contained
- [ ] Low - Minor issue or warning

**Affected Portals**:
- [ ] Creator Portal
- [ ] Investor Portal
- [ ] Production Portal

**User Impact**:
- [ ] Users cannot access data
- [ ] Incorrect data displayed
- [ ] Background process affected
- [ ] No immediate user impact

## Root Cause Analysis

**Suspected Cause**:
- [ ] Missing foreign key constraint
- [ ] Missing CASCADE delete
- [ ] Data migration issue
- [ ] Application logic bug
- [ ] Manual data modification
- [ ] Unknown

**Details**:
Describe what you think caused this issue...

## Proposed Solution

### Immediate Fix (If Critical)
```sql
-- Emergency fix SQL
-- Only if data loss is imminent
```

### Proper Fix
1. Step 1: ...
2. Step 2: ...
3. Step 3: ...

### Migration Required
- [ ] Yes - Create migration file
- [ ] No - Can fix with direct query

## Prevention

To prevent this in the future:
- [ ] Add foreign key constraint
- [ ] Add ON DELETE CASCADE
- [ ] Add check constraint
- [ ] Add trigger
- [ ] Update application logic
- [ ] Add to CI/CD tests

## Checklist

- [ ] Issue reproduced locally
- [ ] Root cause identified
- [ ] Solution tested
- [ ] Migration created
- [ ] Tests pass after fix
- [ ] Documentation updated
- [ ] CI/CD updated if needed

## Additional Context

Add any other context about the problem here.

## Related Issues

- Relates to #
- Blocked by #
- Blocks #

---

## For Reviewers

**Review Checklist**:
- [ ] Solution addresses root cause
- [ ] No data loss in proposed fix
- [ ] Tests updated to catch this in future
- [ ] Migration is reversible
- [ ] Documentation is complete

**Deployment Risk**: (High / Medium / Low)

**Rollback Plan**:
Describe rollback procedure if fix causes issues...
