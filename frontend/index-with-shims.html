<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pitchey - Where Ideas Meet Investment</title>
    
    <!-- DNS prefetch for API domain to reduce resolution delays -->
    <link rel="dns-prefetch" href="//pitchey-api-prod.ndlovucavelle.workers.dev">
    <link rel="preconnect" href="https://pitchey-api-prod.ndlovucavelle.workers.dev" crossorigin>
    <!-- CRITICAL: Pre-load React and use-sync-external-store shim BEFORE vendor bundle -->
    <script>
      // This MUST run before ANY module loading to prevent undefined errors
      (function() {
        'use strict';
        
        // Create a basic React stub with useSyncExternalStore
        var useSyncExternalStoreShim = function(subscribe, getSnapshot) {
          // Minimal implementation - will be replaced by real React
          try {
            return getSnapshot ? getSnapshot() : undefined;
          } catch(e) {
            return undefined;
          }
        };
        
        // Create React stub with the hook
        window.React = window.React || {
          useSyncExternalStore: useSyncExternalStoreShim,
          useState: function(initial) { return [initial, function() {}]; },
          useEffect: function() {},
          useLayoutEffect: function() {},
          useCallback: function(cb) { return cb; },
          useMemo: function(fn) { return fn(); },
          useRef: function(initial) { return { current: initial }; },
          useContext: function() { return {}; },
          useReducer: function(reducer, initial) { return [initial, function() {}]; },
          createElement: function() { return null; },
          Fragment: Symbol ? Symbol.for('react.fragment') : 0xeac7,
          version: '18.3.1'
        };
        
        // Ensure the use-sync-external-store package module is available
        var shimModule = {
          useSyncExternalStore: useSyncExternalStoreShim,
          useSyncExternalStoreWithSelector: useSyncExternalStoreShim,
          useSyncExternalStoreExports: useSyncExternalStoreShim
        };
        
        // Make it available at all possible paths
        window['use-sync-external-store'] = shimModule;
        window['use-sync-external-store/shim'] = shimModule;
        window['use-sync-external-store/shim/index'] = shimModule;
        window['use-sync-external-store/shim/index.js'] = shimModule;
        window['use-sync-external-store/shim/with-selector'] = shimModule;
        window['use-sync-external-store/shim.js'] = shimModule;
        window['use-sync-external-store/shim/index.production.min.js'] = shimModule;
        
        // Intercept module.exports pattern
        if (!window.exports) window.exports = {};
        window.exports['use-sync-external-store'] = shimModule;
        window.exports['use-sync-external-store/shim'] = shimModule;
        
        // Create a fake module system for libraries that check for it
        if (!window.module) window.module = { exports: {} };
        window.module.exports['use-sync-external-store'] = shimModule;
        
        console.log('Pre-vendor shim loaded:', {
          React: !!window.React,
          ReactHook: !!window.React.useSyncExternalStore,
          Module: !!window['use-sync-external-store']
        });
      })();
    </script>
    <!-- Load React shim BEFORE any bundled code -->
    <script src="/react-shim.js"></script>
  </head>
  <body>
    <!-- React Scheduler Polyfill - MUST load before React -->
    <script>
      // Polyfill for React's scheduler to prevent "Cannot set properties of undefined" errors
      (function() {
        if (typeof window !== 'undefined') {
          // Create global performance object if it doesn't exist
          window.performance = window.performance || {};
          window.performance.now = window.performance.now || function() {
            return Date.now();
          };
          
          // Create scheduler polyfill for React
          var Scheduler = {
            unstable_now: function() {
              return performance.now();
            },
            unstable_IdlePriority: 5,
            unstable_ImmediatePriority: 1,
            unstable_LowPriority: 4,
            unstable_NormalPriority: 3,
            unstable_UserBlockingPriority: 2,
            unstable_runWithPriority: function(priority, callback) {
              return callback();
            },
            unstable_next: function(callback) {
              return callback();
            },
            unstable_scheduleCallback: function(priority, callback) {
              return setTimeout(callback, 0);
            },
            unstable_cancelCallback: function(timeoutId) {
              clearTimeout(timeoutId);
            },
            unstable_wrapCallback: function(callback) {
              return callback;
            },
            unstable_getCurrentPriorityLevel: function() {
              return 3; // NormalPriority
            },
            unstable_shouldYield: function() {
              return false;
            },
            unstable_continueExecution: function() {},
            unstable_pauseExecution: function() {},
            unstable_getFirstCallbackNode: function() {
              return null;
            },
            unstable_forceFrameRate: function() {}
          };
          
          // Make Scheduler available globally for React
          window.Scheduler = Scheduler;
          
          // Also set on global for CommonJS compatibility
          if (typeof global !== 'undefined') {
            global.Scheduler = Scheduler;
          }
        }
      })();
    </script>
    <!-- React 18 AsyncMode Compatibility Fix -->
    <script>
      // Immediate fix for AsyncMode issues before any modules load
      (function() {
        // Protect React object from AsyncMode assignments
        if (typeof Object.defineProperty === 'function') {
          var reactProxy = {};
          var reactHandler = {
            get: function(target, prop) {
              if (prop === 'AsyncMode' || prop === 'unstable_AsyncMode') {
                // Return Fragment as fallback for deprecated AsyncMode
                return target.Fragment || function(props) { 
                  return props && props.children ? props.children : null; 
                };
              }
              return target[prop];
            },
            set: function(target, prop, value) {
              var deprecatedProps = ['AsyncMode', 'unstable_AsyncMode', 'isAsyncMode', 'isConcurrentMode'];
              var reactProps = ['ContextConsumer', 'ContextProvider', 'Fragment', 'Element', 'ForwardRef', 'Lazy', 'Memo', 'Portal', 'Profiler', 'StrictMode', 'Suspense', 'SuspenseList', 'isContextConsumer', 'isContextProvider', 'isElement', 'isForwardRef', 'isFragment', 'isLazy', 'isMemo', 'isPortal', 'isProfiler', 'isStrictMode', 'isSuspense', 'isSuspenseList', 'isValidElementType', 'typeOf'];
              
              if (deprecatedProps.includes(prop)) {
                // Silently ignore deprecated props to prevent errors
                console.warn(prop + ' is deprecated in React 18 - assignment ignored');
                return true;
              }
              
              if (reactProps.includes(prop)) {
                // Handle React property assignments safely
                try {
                  if (target && typeof target === 'object') {
                    target[prop] = value;
                    return true;
                  } else {
                    console.warn('Cannot set ' + prop + ' on undefined React object');
                    return false;
                  }
                } catch(e) {
                  console.warn('Failed to set React.' + prop, e);
                  return false;
                }
              }
              
              try {
                target[prop] = value;
                return true;
              } catch(e) {
                console.warn('Failed to set React.' + prop, e);
                return false;
              }
            }
          };
          
          // Set up global React protection
          Object.defineProperty(window, 'React', {
            get: function() { 
              return typeof Proxy !== 'undefined' ? new Proxy(reactProxy, reactHandler) : reactProxy; 
            },
            set: function(value) { 
              if (value && typeof value === 'object') {
                Object.assign(reactProxy, value);
                // Ensure Fragment exists as fallback
                if (!reactProxy.Fragment) {
                  reactProxy.Fragment = function(props) { return props.children; };
                }
              }
              return true;
            },
            configurable: true
          });
        }
      })();

      // UMD Module Definition Polyfill (based on Context7 webpack patterns)
      (function() {
        // Implement the exact UMD pattern from Context7 docs
        if (typeof window !== 'undefined') {
          // Define exports object if it doesn't exist
          if (typeof window.exports === 'undefined') {
            window.exports = {};
          }
          
          // Define module object if it doesn't exist (CommonJS compatibility)
          if (typeof window.module === 'undefined') {
            window.module = { exports: window.exports };
          }
          
          // Global UMD factory function for safe module loading
          window.webpackUniversalModuleDefinition = function(root, factory) {
            if (typeof exports === 'object' && typeof module === 'object') {
              module.exports = factory();
            } else if (typeof define === 'function' && define.amd) {
              define([], factory);
            } else if (typeof exports === 'object') {
              var result = factory();
              for (var key in result) {
                if (result.hasOwnProperty && result.hasOwnProperty(key)) {
                  exports[key] = result[key];
                }
              }
            } else {
              var result = factory();
              for (var key in result) {
                if (result.hasOwnProperty && result.hasOwnProperty(key)) {
                  root[key] = result[key];
                }
              }
            }
          };
          
          // Ensure exports is always an object
          Object.defineProperty(window, 'exports', {
            get: function() { 
              return window.__moduleExports || (window.__moduleExports = {}); 
            },
            set: function(value) { 
              window.__moduleExports = value || {};
              if (window.module) {
                window.module.exports = window.__moduleExports;
              }
            },
            configurable: true,
            enumerable: true
          });
        }
      })();
    </script>
    
    <!-- React Global Provision for libraries that expect it -->
    <script>
      // CRITICAL: Provide React stub until real React loads to prevent undefined errors
      (function() {
        if (typeof window !== 'undefined' && !window.React) {
          // Create a more complete React stub
          var ReactStub = {
            createElement: function() { return null; },
            Component: function() {},
            Fragment: Symbol ? Symbol.for('react.fragment') : 0xeac7,
            StrictMode: Symbol ? Symbol.for('react.strict_mode') : 0xeacc,
            Suspense: Symbol ? Symbol.for('react.suspense') : 0xead1,
            createContext: function() { 
              return { Provider: function() { return null; }, Consumer: function() { return null; } };
            },
            forwardRef: function(render) {
              // Return a component that will work until React loads
              return function ForwardRef(props) {
                return render ? render(props, null) : null;
              };
            },
            lazy: function(loader) { return loader; },
            memo: function(component) { return component; },
            useCallback: function(cb) { return cb; },
            useContext: function() { return {}; },
            useEffect: function() {},
            useLayoutEffect: function() {},
            useMemo: function(fn) { return fn(); },
            useReducer: function(reducer, initialState) { return [initialState, function() {}]; },
            useRef: function(initialValue) { return { current: initialValue }; },
            useState: function(initial) { return [initial, function() {}]; },
            useDebugValue: function() {},
            useImperativeHandle: function() {},
            // CRITICAL: Add React 18 hooks for React Router
            useSyncExternalStore: function(subscribe, getSnapshot) { 
              return getSnapshot ? getSnapshot() : null; 
            },
            useId: function() { return ':r0:'; },
            useTransition: function() { return [false, function(fn) { fn(); }]; },
            useDeferredValue: function(value) { return value; },
            useInsertionEffect: function() {},
            cloneElement: function(element) { return element; },
            isValidElement: function() { return false; },
            Children: {
              map: function(children, fn) { return fn ? fn(children) : children; },
              forEach: function() {},
              count: function() { return 0; },
              toArray: function(children) { return Array.isArray(children) ? children : [children]; },
              only: function(children) { return children; }
            },
            version: '18.2.0'
          };
          
          // Make React available globally
          window.React = ReactStub;
          
          // Also provide ReactDOM stub
          window.ReactDOM = {
            render: function() {},
            hydrate: function() {},
            unmountComponentAtNode: function() {},
            findDOMNode: function() { return null; },
            createPortal: function(children) { return children; }
          };
          
          // Watch for real React to load and replace the stub
          var originalDefineProperty = Object.defineProperty;
          Object.defineProperty = function(obj, prop, descriptor) {
            if (obj === window && (prop === 'React' || prop === 'ReactDOM') && descriptor.value) {
              // Real React is being loaded, let it replace our stub
              console.log('Real ' + prop + ' loaded, replacing stub');
            }
            return originalDefineProperty.call(this, obj, prop, descriptor);
          };
        }
      })();
    </script>
    
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
