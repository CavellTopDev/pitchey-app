# Cloudflare Worker Configuration - Optimized for Free Tier
# Free tier limits:
# - 100,000 requests/day
# - 10ms CPU time per request
# - No Durable Objects
# - 1GB KV storage
# - 100,000 KV reads/day

name = "pitchey-api-free"
main = "src/worker-free-tier.ts"
compatibility_date = "2024-01-01"

# Account and routing
account_id = "your-account-id"
workers_dev = true

# KV namespace binding (Free tier: 1GB storage)
[[kv_namespaces]]
binding = "KV"
id = "your-kv-namespace-id"
preview_id = "your-kv-preview-id"

# Environment variables (non-sensitive)
[vars]
ENVIRONMENT = "production"
FRONTEND_URL = "https://pitchey.pages.dev"

# Secrets (set via wrangler secret put)
# wrangler secret put DATABASE_URL
# wrangler secret put JWT_SECRET

# Build configuration
[build]
command = "npm run build"
watch_paths = ["src/**/*.ts"]

[build.upload]
format = "modules"
main = "./worker-free-tier.ts"

# Development environment
[env.development]
name = "pitchey-api-free-dev"
workers_dev = true

[env.development.vars]
ENVIRONMENT = "development"
FRONTEND_URL = "http://localhost:5173"

# Staging environment (if needed)
[env.staging]
name = "pitchey-api-free-staging"
workers_dev = true

[env.staging.vars]
ENVIRONMENT = "staging"
FRONTEND_URL = "https://staging.pitchey.pages.dev"

# Production environment
[env.production]
name = "pitchey-api-free-prod"
workers_dev = false

# Custom domain (requires paid plan)
# routes = [
#   { pattern = "api.pitchey.com/*", zone_name = "pitchey.com" }
# ]

[env.production.vars]
ENVIRONMENT = "production"
FRONTEND_URL = "https://pitchey.pages.dev"

# Limits configuration (respecting free tier)
[limits]
cpu_ms = 10  # Free tier limit

# Observability (limited on free tier)
[observability]
enabled = false  # Requires paid plan

# Usage model
[usage_model]
default = "bundled"  # Free tier only supports bundled