# Cloudflare Worker Configuration with Cron Triggers
# Extension of wrangler.toml for scheduled tasks

name = "pitchey-optimized"
main = "src/worker-service-optimized.ts"
compatibility_date = "2024-11-01"
node_compat = true

# Account and routing (same as main config)
account_id = "b1f6495b07f1a7573dbbf75b7ea2fa48"
workers_dev = false
route = { pattern = "pitchey-optimized.cavelltheleaddev.workers.dev/*", zone_name = "cavelltheleaddev.workers.dev" }

# Cron triggers for scheduled tasks
[triggers]
crons = [
  # Cache warming - every 5 minutes
  "*/5 * * * *",
  
  # Health check - every 2 minutes
  "*/2 * * * *",
  
  # Cache cleanup - every hour
  "0 * * * *",
  
  # Performance metrics collection - every 15 minutes
  "*/15 * * * *",
  
  # Database connection pool health check - every 10 minutes
  "*/10 * * * *"
]

# Environment variables
[vars]
DENO_ENV = "production"
NODE_ENV = "production"
FRONTEND_URL = "https://pitchey.pages.dev"
SENTRY_ENVIRONMENT = "production"
SENTRY_RELEASE = "cache-warming-v1.0"
CACHE_ENABLED = "true"

# KV Namespaces
[[kv_namespaces]]
binding = "PITCHEY_KV"
id = "your-kv-namespace-id" # Replace with actual KV namespace ID

[[kv_namespaces]]
binding = "METRICS_KV"
id = "your-metrics-kv-id" # Replace with actual KV namespace ID for metrics

# Durable Objects (for WebSocket rooms)
[[durable_objects.bindings]]
name = "WEBSOCKET_ROOMS"
class_name = "WebSocketRoom"
script_name = "pitchey-optimized"

# Hyperdrive binding for database connection pooling
[[hyperdrive]]
binding = "HYPERDRIVE"
id = "f1f81672261b4076bbcf07b115a03ca6"

# R2 bucket for file storage
[[r2_buckets]]
binding = "PITCHEY_STORAGE"
bucket_name = "pitchey-assets"

# Service bindings for modular architecture
[[services]]
binding = "AUTH_SERVICE"
service = "pitchey-auth"
environment = "production"

[[services]]
binding = "PITCH_SERVICE"
service = "pitchey-pitches"
environment = "production"

# Analytics Engine for custom metrics
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "pitchey_metrics"

# Secrets (configure via wrangler secret put)
# JWT_SECRET
# DATABASE_URL
# SENTRY_DSN
# UPSTASH_REDIS_REST_URL
# UPSTASH_REDIS_REST_TOKEN
# STRIPE_SECRET_KEY
# SENDGRID_API_KEY
# SLACK_WEBHOOK_URL