<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitchey API Documentation</title>
    <link rel="icon" type="image/png" href="https://pitchey.com/favicon.png">
    
    <!-- Swagger UI CSS -->
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.10.3/swagger-ui.css" />
    
    <!-- Custom CSS -->
    <style>
        /* Custom theme for Pitchey brand */
        :root {
            --pitchey-primary: #6366f1;
            --pitchey-secondary: #f59e0b;
            --pitchey-dark: #1f2937;
            --pitchey-light: #f9fafb;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* Header */
        .api-header {
            background: linear-gradient(135deg, var(--pitchey-primary) 0%, var(--pitchey-secondary) 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .api-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .api-header p {
            margin: 0.5rem 0 0;
            font-size: 1.125rem;
            opacity: 0.9;
        }

        /* Navigation */
        .api-nav {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: var(--pitchey-dark);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }

        .nav-links a:hover {
            background: var(--pitchey-light);
            color: var(--pitchey-primary);
        }

        .nav-links a.active {
            background: var(--pitchey-primary);
            color: white;
        }

        /* Quick start section */
        .quick-start {
            background: var(--pitchey-light);
            padding: 3rem 0;
            margin-bottom: 2rem;
        }

        .quick-start-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
        }

        .quick-start-content h2 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--pitchey-dark);
            margin: 0 0 1rem;
        }

        .quick-start-content p {
            color: #6b7280;
            font-size: 1.125rem;
            line-height: 1.6;
            margin: 0 0 1.5rem;
        }

        .quick-start-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .btn-primary {
            background: var(--pitchey-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #5b5bd6;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: white;
            color: var(--pitchey-primary);
            border-color: var(--pitchey-primary);
        }

        .btn-secondary:hover {
            background: var(--pitchey-primary);
            color: white;
        }

        .code-example {
            background: var(--pitchey-dark);
            border-radius: 0.75rem;
            padding: 1.5rem;
            color: #f3f4f6;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            overflow-x: auto;
        }

        .code-example .comment {
            color: #9ca3af;
        }

        .code-example .string {
            color: #fbbf24;
        }

        .code-example .keyword {
            color: #a78bfa;
        }

        /* Swagger UI customizations */
        .swagger-ui .topbar {
            display: none;
        }

        .swagger-ui .info .title {
            color: var(--pitchey-primary);
        }

        .swagger-ui .scheme-container {
            background: var(--pitchey-light);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .swagger-ui .btn.authorize {
            background: var(--pitchey-primary);
            border-color: var(--pitchey-primary);
        }

        .swagger-ui .btn.authorize:hover {
            background: #5b5bd6;
        }

        .swagger-ui .opblock.opblock-post {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .swagger-ui .opblock.opblock-get {
            border-color: var(--pitchey-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .swagger-ui .opblock.opblock-put {
            border-color: var(--pitchey-secondary);
            background: rgba(245, 158, 11, 0.1);
        }

        .swagger-ui .opblock.opblock-delete {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Footer */
        .api-footer {
            background: var(--pitchey-dark);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 4rem;
        }

        .api-footer a {
            color: var(--pitchey-secondary);
            text-decoration: none;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .quick-start-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .quick-start-buttons {
                justify-content: center;
            }
        }

        /* Loading animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: var(--pitchey-primary);
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--pitchey-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="api-header">
        <div class="container">
            <h1>Pitchey API</h1>
            <p>Comprehensive API for the movie pitch platform</p>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="api-nav">
        <div class="nav-container">
            <div>
                <strong>Pitchey Developer Portal</strong>
            </div>
            <ul class="nav-links">
                <li><a href="#overview" class="active">API Reference</a></li>
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="sdks.html">SDKs</a></li>
                <li><a href="postman.html">Postman</a></li>
                <li><a href="examples.html">Examples</a></li>
            </ul>
        </div>
    </nav>

    <!-- Quick Start Section -->
    <section class="quick-start">
        <div class="quick-start-container">
            <div class="quick-start-content">
                <h2>Get Started with Pitchey API</h2>
                <p>
                    Build powerful integrations with our comprehensive API. Access pitches, 
                    manage users, handle NDAs, and create custom workflows for the movie industry.
                </p>
                <div class="quick-start-buttons">
                    <a href="#section/Authentication" class="btn btn-primary">View API Docs</a>
                    <a href="getting-started.html" class="btn btn-secondary">Quick Start Guide</a>
                </div>
            </div>
            <div class="code-example">
<span class="comment">// Example: Get public pitches</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">'https://pitchey-production.cavelltheleaddev.workers.dev/api/pitches/public'</span>);
<span class="keyword">const</span> pitches = <span class="keyword">await</span> response.json();

console.log(<span class="string">`Found ${pitches.meta.total} public pitches`</span>);
            </div>
        </div>
    </section>

    <!-- API Documentation Container -->
    <div id="swagger-ui" class="container">
        <div class="loading">
            <div class="spinner"></div>
            <span style="margin-left: 1rem;">Loading API documentation...</span>
        </div>
    </div>

    <!-- Footer -->
    <footer class="api-footer">
        <div class="container">
            <p>
                Built with ‚ù§Ô∏è by the Pitchey team. 
                <a href="https://pitchey.com">Visit Pitchey</a> | 
                <a href="mailto:developers@pitchey.com">Contact Support</a>
            </p>
        </div>
    </footer>

    <!-- Swagger UI Bundle -->
    <script src="https://unpkg.com/swagger-ui-dist@5.10.3/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.10.3/swagger-ui-standalone-preset.js"></script>
    
    <script>
        // Initialize Swagger UI
        window.onload = function() {
            const ui = SwaggerUIBundle({
                url: './openapi.yaml',
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                theme: "light",
                tryItOutEnabled: true,
                requestInterceptor: (request) => {
                    // Add API key if available
                    const apiKey = localStorage.getItem('pitchey_api_key');
                    if (apiKey && !request.headers.Authorization) {
                        request.headers.Authorization = `Bearer ${apiKey}`;
                    }
                    return request;
                },
                responseInterceptor: (response) => {
                    // Handle rate limiting headers
                    if (response.headers['x-ratelimit-remaining']) {
                        console.log('Rate limit remaining:', response.headers['x-ratelimit-remaining']);
                    }
                    return response;
                },
                onComplete: () => {
                    // Add custom authentication helper
                    addAuthenticationHelper();
                    
                    // Add API testing tools
                    addTestingTools();
                    
                    // Track usage analytics
                    trackApiUsage();
                },
                validatorUrl: null, // Disable validator for local development
                displayRequestDuration: true,
                docExpansion: 'list',
                filter: true,
                showExtensions: true,
                showCommonExtensions: true,
                defaultModelsExpandDepth: 2,
                defaultModelExpandDepth: 2,
                supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'],
                oauth2RedirectUrl: window.location.origin + '/docs/api/oauth2-redirect.html'
            });

            // Store UI reference for custom functions
            window.pitcheySwaggerUI = ui;
        };

        // Custom authentication helper
        function addAuthenticationHelper() {
            // Add API key input to the page
            const authSection = document.createElement('div');
            authSection.innerHTML = `
                <div style="background: var(--pitchey-light); padding: 1rem; border-radius: 0.5rem; margin: 1rem 0; border-left: 4px solid var(--pitchey-primary);">
                    <h4 style="margin: 0 0 0.5rem; color: var(--pitchey-dark);">üîê Authentication</h4>
                    <p style="margin: 0 0 1rem; color: #6b7280; font-size: 0.875rem;">
                        Enter your API key to test authenticated endpoints. Get your key from the 
                        <a href="https://pitchey.com/dashboard/api-keys" target="_blank" style="color: var(--pitchey-primary);">developer dashboard</a>.
                    </p>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <input 
                            type="password" 
                            id="api-key-input" 
                            placeholder="Enter your API key..."
                            style="flex: 1; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.25rem;"
                        />
                        <button 
                            onclick="setApiKey()" 
                            style="padding: 0.5rem 1rem; background: var(--pitchey-primary); color: white; border: none; border-radius: 0.25rem; cursor: pointer;"
                        >
                            Set Key
                        </button>
                        <button 
                            onclick="clearApiKey()" 
                            style="padding: 0.5rem 1rem; background: #6b7280; color: white; border: none; border-radius: 0.25rem; cursor: pointer;"
                        >
                            Clear
                        </button>
                    </div>
                    <div id="auth-status" style="margin-top: 0.5rem; font-size: 0.875rem;"></div>
                </div>
            `;
            
            const swaggerContainer = document.getElementById('swagger-ui');
            swaggerContainer.insertBefore(authSection, swaggerContainer.firstChild);
            
            // Show current auth status
            updateAuthStatus();
        }

        // Set API key function
        function setApiKey() {
            const input = document.getElementById('api-key-input');
            const apiKey = input.value.trim();
            
            if (apiKey) {
                localStorage.setItem('pitchey_api_key', apiKey);
                input.value = '';
                updateAuthStatus();
                
                // Update Swagger UI authorization
                if (window.pitcheySwaggerUI) {
                    window.pitcheySwaggerUI.preauthorizeApiKey('bearerAuth', apiKey);
                }
            }
        }

        // Clear API key function
        function clearApiKey() {
            localStorage.removeItem('pitchey_api_key');
            updateAuthStatus();
            
            // Clear Swagger UI authorization
            if (window.pitcheySwaggerUI) {
                window.pitcheySwaggerUI.logout();
            }
        }

        // Update auth status display
        function updateAuthStatus() {
            const statusDiv = document.getElementById('auth-status');
            const apiKey = localStorage.getItem('pitchey_api_key');
            
            if (apiKey) {
                statusDiv.innerHTML = `
                    <span style="color: #10b981;">‚úì Authenticated</span> 
                    <span style="color: #6b7280;">(Key: ${apiKey.substring(0, 8)}...)</span>
                `;
            } else {
                statusDiv.innerHTML = '<span style="color: #ef4444;">Not authenticated</span>';
            }
        }

        // Add testing tools
        function addTestingTools() {
            // Add demo accounts section
            const demoSection = document.createElement('div');
            demoSection.innerHTML = `
                <div style="background: #fef3c7; padding: 1rem; border-radius: 0.5rem; margin: 1rem 0; border-left: 4px solid var(--pitchey-secondary);">
                    <h4 style="margin: 0 0 0.5rem; color: var(--pitchey-dark);">üß™ Demo Accounts</h4>
                    <p style="margin: 0 0 1rem; color: #6b7280; font-size: 0.875rem;">
                        Use these demo accounts to test the API (password: Demo123):
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 0.5rem;">
                        <div>
                            <strong>Creator:</strong> alex.creator@demo.com<br>
                            <button onclick="loginDemo('creator')" style="margin-top: 0.25rem; padding: 0.25rem 0.5rem; background: var(--pitchey-primary); color: white; border: none; border-radius: 0.25rem; cursor: pointer; font-size: 0.75rem;">Login as Creator</button>
                        </div>
                        <div>
                            <strong>Investor:</strong> sarah.investor@demo.com<br>
                            <button onclick="loginDemo('investor')" style="margin-top: 0.25rem; padding: 0.25rem 0.5rem; background: var(--pitchey-primary); color: white; border: none; border-radius: 0.25rem; cursor: pointer; font-size: 0.75rem;">Login as Investor</button>
                        </div>
                        <div>
                            <strong>Production:</strong> stellar.production@demo.com<br>
                            <button onclick="loginDemo('production')" style="margin-top: 0.25rem; padding: 0.25rem 0.5rem; background: var(--pitchey-primary); color: white; border: none; border-radius: 0.25rem; cursor: pointer; font-size: 0.75rem;">Login as Production</button>
                        </div>
                    </div>
                </div>
            `;
            
            const swaggerContainer = document.getElementById('swagger-ui');
            const authSection = swaggerContainer.firstElementChild;
            swaggerContainer.insertBefore(demoSection, authSection.nextSibling);
        }

        // Demo login function
        async function loginDemo(userType) {
            const credentials = {
                creator: { email: 'alex.creator@demo.com', password: 'Demo123' },
                investor: { email: 'sarah.investor@demo.com', password: 'Demo123' },
                production: { email: 'stellar.production@demo.com', password: 'Demo123' }
            };

            try {
                const response = await fetch(`https://pitchey-production.cavelltheleaddev.workers.dev/api/auth/${userType}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(credentials[userType])
                });

                const data = await response.json();
                
                if (data.token) {
                    localStorage.setItem('pitchey_api_key', data.token);
                    updateAuthStatus();
                    alert(`Logged in as ${userType} successfully!`);
                    
                    // Update Swagger UI authorization
                    if (window.pitcheySwaggerUI) {
                        window.pitcheySwaggerUI.preauthorizeApiKey('bearerAuth', data.token);
                    }
                } else {
                    alert('Login failed: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        // Track API usage analytics
        function trackApiUsage() {
            // Track page views
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_view', {
                    page_title: 'API Documentation',
                    page_location: window.location.href
                });
            }

            // Track API endpoint interactions
            document.addEventListener('click', (event) => {
                if (event.target.closest('.opblock-summary')) {
                    const endpoint = event.target.closest('.opblock').querySelector('.opblock-summary-path span').textContent;
                    const method = event.target.closest('.opblock').querySelector('.opblock-summary-method').textContent;
                    
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'api_endpoint_view', {
                            endpoint: endpoint,
                            method: method
                        });
                    }
                }
            });
        }

        // Handle navigation
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-links a');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    navLinks.forEach(l => l.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });
        });
    </script>

    <!-- Google Analytics (if needed) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
</body>
</html>