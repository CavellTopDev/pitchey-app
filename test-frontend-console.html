<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pitchey Frontend Console Monitor</title>
    <style>
        body {
            font-family: 'Monaco', 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            margin: 0;
        }
        h1 { color: #569cd6; }
        .status { 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0;
            background: #2d2d30;
        }
        .error { background: #5a1d1d; color: #f48771; }
        .success { background: #1d5a1d; color: #4ec9b0; }
        .warning { background: #5a5a1d; color: #dcdcaa; }
        .log-entry {
            padding: 8px;
            margin: 5px 0;
            border-left: 3px solid #3c3c3c;
            background: #252526;
        }
        .timestamp { color: #858585; font-size: 0.9em; }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover { background: #1177bb; }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #3c3c3c;
            margin-top: 20px;
        }
        #logs {
            max-height: 400px;
            overflow-y: auto;
            background: #1e1e1e;
            padding: 10px;
            border: 1px solid #3c3c3c;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üîç Pitchey Frontend Console Monitor</h1>
    
    <div class="status" id="connection-status">
        Checking connection status...
    </div>

    <div>
        <button onclick="testHomepage()">Test Homepage</button>
        <button onclick="testBrowse()">Test Browse</button>
        <button onclick="testAuth()">Test Auth</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <div id="logs">
        <div class="log-entry">
            <span class="timestamp">[Starting monitor...]</span>
        </div>
    </div>

    <iframe id="app-frame" src="http://localhost:5173" title="Pitchey App"></iframe>

    <script>
        const logs = document.getElementById('logs');
        const statusDiv = document.getElementById('connection-status');
        const appFrame = document.getElementById('app-frame');

        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            logs.innerHTML = '<div class="log-entry"><span class="timestamp">[Logs cleared]</span></div>';
        }

        async function checkConnection() {
            try {
                // Test backend
                const backendResponse = await fetch('http://localhost:8001/api/health');
                const backendOk = backendResponse.ok;
                
                // Test frontend
                const frontendResponse = await fetch('http://localhost:5173');
                const frontendOk = frontendResponse.ok;
                
                if (backendOk && frontendOk) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ Frontend and Backend are connected and running';
                    addLog('Connection check successful', 'success');
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = `‚ùå Connection issue - Backend: ${backendOk ? 'OK' : 'Failed'}, Frontend: ${frontendOk ? 'OK' : 'Failed'}`;
                    addLog('Connection check failed', 'error');
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Connection failed: ' + error.message;
                addLog('Connection error: ' + error.message, 'error');
            }
        }

        async function testHomepage() {
            addLog('Testing homepage data fetch...', 'info');
            try {
                const response = await fetch('http://localhost:8001/api/pitches?limit=5');
                const data = await response.json();
                if (data.success) {
                    addLog(`‚úÖ Homepage: Fetched ${data.data.length} pitches`, 'success');
                } else {
                    addLog('‚ùå Homepage: ' + (data.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                addLog('‚ùå Homepage test failed: ' + error.message, 'error');
            }
        }

        async function testBrowse() {
            addLog('Testing browse endpoint...', 'info');
            try {
                const response = await fetch('http://localhost:8001/api/browse?tab=trending');
                const data = await response.json();
                if (data.success) {
                    addLog(`‚úÖ Browse: ${data.data.items.length} items in ${data.data.tab} tab`, 'success');
                } else {
                    addLog('‚ùå Browse: ' + (data.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                addLog('‚ùå Browse test failed: ' + error.message, 'error');
            }
        }

        async function testAuth() {
            addLog('Testing auth session...', 'info');
            try {
                const response = await fetch('http://localhost:8001/api/auth/session', {
                    credentials: 'include'
                });
                const data = await response.json();
                if (response.status === 401) {
                    addLog('‚ö†Ô∏è Auth: Not logged in (expected for public access)', 'warning');
                } else if (data.success) {
                    addLog('‚úÖ Auth: Session active', 'success');
                } else {
                    addLog('‚ùå Auth: ' + (data.error?.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                addLog('‚ùå Auth test failed: ' + error.message, 'error');
            }
        }

        // Listen for messages from iframe (if we implement postMessage in the app)
        window.addEventListener('message', (event) => {
            if (event.origin === 'http://localhost:5173') {
                addLog(`üì® Message from app: ${JSON.stringify(event.data)}`, 'info');
            }
        });

        // Initial check
        checkConnection();

        // Monitor iframe load
        appFrame.addEventListener('load', () => {
            addLog('üåê Frontend loaded in iframe', 'success');
        });

        appFrame.addEventListener('error', (e) => {
            addLog('‚ùå Iframe error: ' + e.message, 'error');
        });

        // Auto-refresh connection status every 10 seconds
        setInterval(checkConnection, 10000);
    </script>
</body>
</html>