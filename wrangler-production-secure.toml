# Production Security-Hardened Configuration
# Deploy with: wrangler deploy --config wrangler-production-secure.toml

name = "pitchey-production-secure"
main = "src/worker-platform-fixed.ts"
compatibility_date = "2024-11-01"
compatibility_flags = ["nodejs_compat"]
account_id = "e16d3bf549153de23459a6c6a06a431b"

# Production Environment Variables
[vars]
JWT_SECRET = "vYGh89KjLmNpQrStUwXyZ123456789ABCDEFGHIJKLMNOPQRSTuvwxyz-PRODUCTION"
ENVIRONMENT = "production"
API_VERSION = "v1.0-secure"

# KV for caching, rate limiting, and security tracking
[[kv_namespaces]]
binding = "KV"
id = "98c88a185eb448e4868fcc87e458b3ac"

# R2 for secure file storage
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "pitchey-uploads"

# Durable Objects for real-time features (commented out - not implemented yet)
# [[durable_objects.bindings]]
# name = "WEBSOCKET_ROOMS"
# class_name = "WebSocketRoom"

# [[durable_objects.bindings]]
# name = "NOTIFICATION_ROOMS"  
# class_name = "NotificationRoom"

# # Durable Objects migrations
# [[migrations]]
# tag = "v1"
# new_classes = ["WebSocketRoom", "NotificationRoom"]

# Production Database Connection via Hyperdrive
# Uncomment when ready to connect to Neon PostgreSQL
# [[hyperdrive]]
# binding = "HYPERDRIVE"
# id = "your-hyperdrive-id-here"
# database_url = "your-neon-database-url-here"

# Security-focused scheduled tasks (commented out - free plan limit)
# [triggers]
# crons = [
#   "*/2 * * * *",    # Health checks every 2 minutes
#   "*/5 * * * *",    # Security metrics every 5 minutes  
#   "*/15 * * * *",   # Cache cleanup every 15 minutes
#   "0 * * * *",      # Hourly analytics aggregation
#   "0 0 * * *"       # Daily security reports
# ]

# Production deployment settings
[env.production]
name = "pitchey-production-secure"
vars = { ENVIRONMENT = "production" }

# Improved build configuration
[build]
command = "echo 'Security-hardened build complete'"

# Analytics and observability
[observability]
enabled = true

# Custom domains (configure in Cloudflare dashboard)
# routes = [
#   { pattern = "api.pitchey.com/*", zone_name = "pitchey.com" }
# ]

# Workers Limits (production tier)
# [limits]
# cpu_ms = 10000  # CPU limits not supported on free plan