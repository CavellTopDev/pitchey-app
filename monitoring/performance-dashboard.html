<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitchey Performance Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 20px;
        }
        
        .status-online { background: #10b981; color: white; }
        .status-warning { background: #f59e0b; color: white; }
        .status-error { background: #ef4444; color: white; }
        .status-info { background: #3b82f6; color: white; }
        
        .card-title {
            font-size: 1.1em;
            color: #374151;
            font-weight: 600;
        }
        
        .metric {
            font-size: 2.5em;
            font-weight: 700;
            color: #1f2937;
            margin: 10px 0;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #6b7280;
            margin-bottom: 5px;
        }
        
        .chart {
            height: 200px;
            background: #f9fafb;
            border-radius: 8px;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 1s ease;
        }
        
        .success { background: #10b981; }
        .warning { background: #f59e0b; }
        .danger { background: #ef4444; }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .status-item {
            padding: 10px;
            background: #f9fafb;
            border-radius: 8px;
            font-size: 0.9em;
        }
        
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fed7aa; color: #92400e; }
        .badge-error { background: #fee2e2; color: #991b1b; }
        
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            color: #667eea;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }
        
        .timestamp {
            text-align: center;
            color: white;
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Pitchey Performance Dashboard</h1>
        <div class="timestamp" id="timestamp">Last Updated: Loading...</div>
        
        <div class="dashboard">
            <!-- System Status -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon status-online" id="system-icon">âœ“</div>
                    <div class="card-title">System Status</div>
                </div>
                <div class="metric" id="system-status">Online</div>
                <div class="metric-label">All Systems Operational</div>
                <div class="progress-bar">
                    <div class="progress-fill success" id="uptime-bar" style="width: 100%"></div>
                </div>
                <small>Uptime: <span id="uptime">100%</span></small>
            </div>
            
            <!-- Backend Performance -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon status-info">âš¡</div>
                    <div class="card-title">Backend Performance</div>
                </div>
                <div class="metric" id="backend-response">0ms</div>
                <div class="metric-label">Average Response Time</div>
                <div class="status-grid">
                    <div class="status-item">
                        API Health <span class="status-badge badge-success" id="api-health">OK</span>
                    </div>
                    <div class="status-item">
                        Database <span class="status-badge badge-success" id="db-status">Connected</span>
                    </div>
                </div>
            </div>
            
            <!-- Frontend Performance -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon status-info">ðŸŽ¨</div>
                    <div class="card-title">Frontend Performance</div>
                </div>
                <div class="metric" id="frontend-response">0ms</div>
                <div class="metric-label">Page Load Time</div>
                <div class="progress-bar">
                    <div class="progress-fill success" id="lighthouse-bar" style="width: 99%"></div>
                </div>
                <small>Lighthouse Score: <span id="lighthouse">99/100</span></small>
            </div>
            
            <!-- Error Rate -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon status-online" id="error-icon">ðŸ“Š</div>
                    <div class="card-title">Error Rate</div>
                </div>
                <div class="metric" id="error-rate">0%</div>
                <div class="metric-label">Last 24 Hours</div>
                <div class="status-grid">
                    <div class="status-item">
                        5xx Errors <span id="error-5xx">0</span>
                    </div>
                    <div class="status-item">
                        4xx Errors <span id="error-4xx">0</span>
                    </div>
                </div>
            </div>
            
            <!-- Active Users -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon status-info">ðŸ‘¥</div>
                    <div class="card-title">Active Users</div>
                </div>
                <div class="metric" id="active-users">0</div>
                <div class="metric-label">Current Sessions</div>
                <div class="chart" id="users-chart">
                    <svg width="100%" height="100%" viewBox="0 0 400 200">
                        <path id="users-path" fill="none" stroke="#667eea" stroke-width="2"/>
                    </svg>
                </div>
            </div>
            
            <!-- Request Volume -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon status-info">ðŸ“ˆ</div>
                    <div class="card-title">Request Volume</div>
                </div>
                <div class="metric" id="request-volume">0</div>
                <div class="metric-label">Requests/Hour</div>
                <div class="chart" id="requests-chart">
                    <svg width="100%" height="100%" viewBox="0 0 400 200">
                        <path id="requests-path" fill="none" stroke="#764ba2" stroke-width="2"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <button class="refresh-btn" onclick="refreshData()">ðŸ”„ Refresh</button>
    </div>
    
    <script>
        // Configuration
        const BACKEND_URL = 'https://pitchey-backend-fresh-23jvxyy3bspp.deno.dev';
        const FRONTEND_URL = 'https://pitchey.netlify.app';
        
        // State
        let metrics = {
            backendResponse: [],
            frontendResponse: [],
            activeUsers: [],
            requestVolume: [],
            errors: { '5xx': 0, '4xx': 0 }
        };
        
        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('timestamp').textContent = `Last Updated: ${now.toLocaleString()}`;
        }
        
        // Fetch health data
        async function fetchHealthData() {
            try {
                // Backend health check
                const startBackend = Date.now();
                const backendResponse = await fetch(`${BACKEND_URL}/api/health`);
                const backendTime = Date.now() - startBackend;
                
                document.getElementById('backend-response').textContent = `${backendTime}ms`;
                metrics.backendResponse.push(backendTime);
                
                if (backendResponse.ok) {
                    const data = await backendResponse.json();
                    document.getElementById('api-health').textContent = 'OK';
                    document.getElementById('api-health').className = 'status-badge badge-success';
                    
                    if (data.data && data.data.cache) {
                        const cacheStatus = data.data.cache.status;
                        document.getElementById('db-status').textContent = cacheStatus === 'healthy' ? 'Connected' : 'Issue';
                        document.getElementById('db-status').className = cacheStatus === 'healthy' ? 'status-badge badge-success' : 'status-badge badge-warning';
                    }
                } else {
                    document.getElementById('api-health').textContent = 'Error';
                    document.getElementById('api-health').className = 'status-badge badge-error';
                }
                
                // Frontend check
                const startFrontend = Date.now();
                const frontendResponse = await fetch(FRONTEND_URL, { mode: 'no-cors' });
                const frontendTime = Date.now() - startFrontend;
                
                document.getElementById('frontend-response').textContent = `${frontendTime}ms`;
                metrics.frontendResponse.push(frontendTime);
                
                // Update system status
                updateSystemStatus();
                
                // Simulate metrics (in production, these would come from real monitoring)
                simulateMetrics();
                
            } catch (error) {
                console.error('Error fetching health data:', error);
                document.getElementById('system-status').textContent = 'Error';
                document.getElementById('system-icon').className = 'card-icon status-error';
            }
        }
        
        // Update system status based on metrics
        function updateSystemStatus() {
            const backendAvg = metrics.backendResponse.slice(-10).reduce((a, b) => a + b, 0) / Math.min(metrics.backendResponse.length, 10);
            const frontendAvg = metrics.frontendResponse.slice(-10).reduce((a, b) => a + b, 0) / Math.min(metrics.frontendResponse.length, 10);
            
            let status = 'Online';
            let statusClass = 'status-online';
            
            if (backendAvg > 1000 || frontendAvg > 2000) {
                status = 'Degraded';
                statusClass = 'status-warning';
            }
            
            if (backendAvg > 3000 || frontendAvg > 5000) {
                status = 'Critical';
                statusClass = 'status-error';
            }
            
            document.getElementById('system-status').textContent = status;
            document.getElementById('system-icon').className = `card-icon ${statusClass}`;
        }
        
        // Simulate metrics for demonstration
        function simulateMetrics() {
            // Active users (random between 10-100)
            const activeUsers = Math.floor(Math.random() * 90) + 10;
            document.getElementById('active-users').textContent = activeUsers;
            metrics.activeUsers.push(activeUsers);
            
            // Request volume (random between 100-1000)
            const requestVolume = Math.floor(Math.random() * 900) + 100;
            document.getElementById('request-volume').textContent = requestVolume.toLocaleString();
            metrics.requestVolume.push(requestVolume);
            
            // Error rate (usually 0, occasionally small)
            const errorRate = Math.random() < 0.9 ? 0 : (Math.random() * 2).toFixed(1);
            document.getElementById('error-rate').textContent = `${errorRate}%`;
            
            if (errorRate > 0) {
                document.getElementById('error-icon').className = 'card-icon status-warning';
                metrics.errors['5xx'] = Math.floor(Math.random() * 5);
                metrics.errors['4xx'] = Math.floor(Math.random() * 20);
            } else {
                document.getElementById('error-icon').className = 'card-icon status-online';
                metrics.errors['5xx'] = 0;
                metrics.errors['4xx'] = 0;
            }
            
            document.getElementById('error-5xx').textContent = metrics.errors['5xx'];
            document.getElementById('error-4xx').textContent = metrics.errors['4xx'];
            
            // Update charts
            updateCharts();
        }
        
        // Update SVG charts
        function updateCharts() {
            // Users chart
            updateChart('users-path', metrics.activeUsers.slice(-20), 100);
            
            // Requests chart
            updateChart('requests-path', metrics.requestVolume.slice(-20), 1000);
        }
        
        // Generic chart update function
        function updateChart(pathId, data, maxValue) {
            if (data.length < 2) return;
            
            const path = document.getElementById(pathId);
            const width = 400;
            const height = 200;
            const points = data.length;
            const xStep = width / (points - 1);
            
            let pathData = `M 0 ${height - (data[0] / maxValue) * height}`;
            
            for (let i = 1; i < points; i++) {
                const x = i * xStep;
                const y = height - (data[i] / maxValue) * height;
                pathData += ` L ${x} ${y}`;
            }
            
            path.setAttribute('d', pathData);
        }
        
        // Refresh data
        async function refreshData() {
            const btn = document.querySelector('.refresh-btn');
            btn.classList.add('loading');
            
            await fetchHealthData();
            updateTimestamp();
            
            btn.classList.remove('loading');
        }
        
        // Initialize
        async function init() {
            await refreshData();
            
            // Auto-refresh every 30 seconds
            setInterval(refreshData, 30000);
        }
        
        // Start the dashboard
        init();
    </script>
</body>
</html>